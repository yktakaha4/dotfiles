#!/usr/bin/env zsh

set -eu

namespace="$1"
pod_name_prefix="$2"
isauto=${3:+"-a"}

pod_names="$(kubectl get pods -n "$namespace" --template '{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}' | awk '$1~"^'"$pod_name_prefix"'"')"
if [[ "$pod_names" = "" ]]; then
    exit 1
fi
node "$NODETOOLS_PATH/select.js" $isauto -m "Select pod" $(echo "$pod_names" | paste -s)
